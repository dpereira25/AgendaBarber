{% extends 'base.html' %}
{% block content %}

<!-- Mensaje de bienvenida personalizado -->
{% if user.is_authenticated %}
    <div class="row mb-4">
        <div class="col-12">
            <div class="alert {% if es_barbero %}alert-primary{% else %}alert-success{% endif %} border-0 shadow-sm">
                <h4 class="alert-heading mb-2">
                    <i class="fas {% if es_barbero %}fa-user-tie{% else %}fa-user{% endif %} me-2"></i>
                    ¬°Bienvenido{% if es_barbero %} de vuelta{% endif %}, {{ user.get_full_name|default:user.username }}!
                </h4>
                <p class="mb-0">
                    {% if es_barbero %}
                        Aqu√≠ tienes un resumen de tus reservas pendientes para hoy.
                    {% else %}
                        Aqu√≠ puedes ver tus pr√≥ximas reservas y agendar nuevos servicios.
                    {% endif %}
                </p>
            </div>
        </div>
    </div>
{% else %}
    <div class="row mb-5">
        <div class="col-12 text-center">
            <h1 class="display-4 fw-bold text-primary mb-3">Agenda Barber üíà</h1>
            <p class="lead text-muted mb-4">Tu barber√≠a de confianza. Agenda tu cita de forma f√°cil y r√°pida.</p>
            <div class="d-flex justify-content-center gap-3">
                <a href="{% url 'login' %}" class="btn btn-primary btn-lg">
                    <i class="fas fa-sign-in-alt me-2"></i>Iniciar Sesi√≥n
                </a>
                <a href="{% url 'registro' %}" class="btn btn-outline-primary btn-lg">
                    <i class="fas fa-user-plus me-2"></i>Registrarse
                </a>
            </div>
        </div>
    </div>
{% endif %}

<!-- Secci√≥n personalizada para barberos -->
{% if user.is_authenticated and es_barbero %}
<div class="row mb-5">
    <div class="col-12">
        <div class="card border-primary">
            <div class="card-header bg-primary text-white">
                <h4 class="mb-0">
                    <i class="fas fa-calendar-day me-2"></i>Tus Reservas Pendientes de Hoy
                </h4>
            </div>
            <div class="card-body">
                {% if reservas_hoy %}
                    <div class="row">
                        {% for reserva in reservas_hoy %}
                        <div class="col-md-6 col-lg-4 mb-3">
                            <div class="card border-warning">
                                <div class="card-body">
                                    <div class="d-flex justify-content-between align-items-start mb-2">
                                        <h6 class="card-title mb-0">{{ reserva.inicio|date:"H:i" }}</h6>
                                        <span class="badge bg-warning">Pendiente</span>
                                    </div>
                                    <p class="card-text mb-1">
                                        <i class="fas fa-user me-1"></i>
                                        <strong>{{ reserva.cliente.get_full_name|default:reserva.cliente.username }}</strong>
                                    </p>
                                    <p class="card-text mb-1">
                                        <i class="fas fa-cut me-1"></i>{{ reserva.servicio.nombre }}
                                    </p>
                                    <p class="card-text mb-0 text-muted small">
                                        <i class="fas fa-clock me-1"></i>{{ reserva.servicio.duracion_minutos }} min
                                    </p>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                    <div class="text-center mt-3">
                        <a href="{% url 'agenda_barbero' %}" class="btn btn-primary">
                            <i class="fas fa-calendar-alt me-1"></i>Ver Agenda Completa
                        </a>
                    </div>
                {% else %}
                    <div class="text-center py-4">
                        <i class="fas fa-calendar-check fa-3x text-muted mb-3"></i>
                        <h5 class="text-muted">No tienes reservas pendientes para hoy</h5>
                        <p class="text-muted">¬°Perfecto! Puedes relajarte o revisar tu agenda completa.</p>
                        <a href="{% url 'agenda_barbero' %}" class="btn btn-outline-primary">
                            <i class="fas fa-calendar-alt me-1"></i>Ver Mi Agenda
                        </a>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endif %}

<!-- Secci√≥n personalizada para clientes -->
{% if user.is_authenticated and es_cliente %}
<div class="row mb-5">
    <div class="col-12">
        <div class="card border-success">
            <div class="card-header bg-success text-white">
                <h4 class="mb-0">
                    <i class="fas fa-clock me-2"></i>Tus Pr√≥ximas Reservas
                </h4>
            </div>
            <div class="card-body">
                {% if proximas_reservas %}
                    <div class="row">
                        {% for reserva in proximas_reservas %}
                        <div class="col-md-6 col-lg-4 mb-3">
                            <div class="card {% if reserva.estado == 'Confirmada' %}border-success{% else %}border-warning{% endif %}">
                                <div class="card-body">
                                    <div class="d-flex justify-content-between align-items-start mb-2">
                                        <h6 class="card-title mb-0">{{ reserva.inicio|date:"d/m" }} - {{ reserva.inicio|date:"H:i" }}</h6>
                                        <span class="badge {% if reserva.estado == 'Confirmada' %}bg-success{% else %}bg-warning{% endif %}">
                                            {{ reserva.estado }}
                                        </span>
                                    </div>
                                    <p class="card-text mb-1">
                                        <i class="fas fa-user-tie me-1"></i>
                                        <strong>{{ reserva.barbero.nombre }}</strong>
                                    </p>
                                    <p class="card-text mb-1">
                                        <i class="fas fa-cut me-1"></i>{{ reserva.servicio.nombre }}
                                    </p>
                                    <p class="card-text mb-0 text-muted small">
                                        <i class="fas fa-calendar me-1"></i>{{ reserva.inicio|date:"l" }}
                                    </p>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                    <div class="text-center mt-3">
                        <a href="{% url 'mis_reservas' %}" class="btn btn-success">
                            <i class="fas fa-list me-1"></i>Ver Todas Mis Reservas
                        </a>
                    </div>
                {% else %}
                    <div class="text-center py-4">
                        <i class="fas fa-calendar-plus fa-3x text-muted mb-3"></i>
                        <h5 class="text-muted">No tienes reservas pr√≥ximas</h5>
                        <p class="text-muted">¬°Es hora de agendar tu pr√≥ximo corte!</p>
                        <a href="{% url 'crear_reserva' %}" class="btn btn-success">
                            <i class="fas fa-plus me-1"></i>Crear Nueva Reserva
                        </a>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endif %}

{% if servicios %}
<div class="row mb-4">
    <div class="col-12">
        <h2 class="text-center">
            {% if user.is_authenticated %}
                Servicios Disponibles
            {% else %}
                Nuestros Servicios Destacados
            {% endif %}
        </h2>
        {% if not user.is_authenticated %}
            <p class="text-center text-muted">Descubre nuestros servicios profesionales de barber√≠a</p>
        {% endif %}
    </div>
</div>

<div class="scrollable-cards-container mb-5">
    
    {% for servicio in servicios %}
    <div class="card-feature"> 
        <div class="card h-100 shadow border-0 bg-white">
            
            <div class="ratio ratio-4x3"> 
                <img src="{{ servicio.imagen.url }}" class="card-img-top w-100 h-100" 
                     alt="{{ servicio.nombre }}" style="object-fit: cover; border-radius: .375rem .375rem 0 0;">
            </div>
            
            <div class="card-body d-flex flex-column">
                <h5 class="card-title text-primary">{{ servicio.nombre }}</h5>
                <p class="card-text text-muted small">
                    {{ servicio.descripcion|truncatewords:15 }}
                </p>
                <p class="h4 text-danger mt-auto">
                    ${{ servicio.precio }}
                </p>
            </div>
            <div class="card-footer bg-white border-0 pt-0">
                <a href="{% url 'crear_reserva' %}?servicio_id={{ servicio.id }}" class="btn btn-dark w-100">
                    Reservar ahora
                </a>
            </div>
        </div>
    </div>
    {% endfor %}

</div>
{% endif %}

<!-- Bot√≥n centrado -->
<div class="row">
    <div class="col-12 text-center">
        <button type="button" class="btn btn-info btn-lg" data-bs-toggle="modal" data-bs-target="#infoModal">
            Informaci√≥n importante üíà
        </button>
    </div>
</div>

<!-- Modal centrado -->
<div class="modal fade" id="infoModal" tabindex="-1" aria-labelledby="infoModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-lg">
    <div class="modal-content bg-dark text-white">
      <div class="modal-header border-0">
        <h5 class="modal-title" id="infoModalLabel">Conceptos que debes entender</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Cerrar"></button>
      </div>
      <div class="modal-body">
        <p>Actualmente en internet hay muchos conceptos que te pueden dificultar la elecci√≥n de tu corte de pelo, pero aqu√≠ te los explico de manera sencilla.</p>
        <p><strong>FADE:</strong> ‚ÄúFade‚Äù es literalmente ‚Äúdegradado‚Äù en ingl√©s. Cuando dicen <em>high</em>, <em>medium</em> o <em>low</em>, se refieren a la altura del degradado.</p>
        <p><strong>TEXTURA:</strong> Se refiere a crear irregularidades en la parte superior para dar movimiento y un aspecto m√°s casual o ‚Äúdespeinado‚Äù.</p>
        <p><strong>COMPRIMIDO:</strong> Hace referencia a qu√© tan estirado quieres el degradado: uno comprimido es corto y de alto impacto visual; uno estirado es m√°s pulido.</p>
        <p><strong>TERMINACI√ìN:</strong> Puede ser redonda, cuadrada o en punta (V). No todos los degradados deben ser rapados, lo que permite patillas o terminaciones personalizadas.</p>
        <p class="mt-3 text-center">üí° <em>Esperamos que esta informaci√≥n te ayude a elegir tu pr√≥ximo estilo.</em></p>
      </div>
      <div class="modal-footer border-0 justify-content-center">
        <button type="button" class="btn btn-outline-light" data-bs-dismiss="modal">Cerrar</button>
      </div>
    </div>
  </div>
</div>
{% endblock %}